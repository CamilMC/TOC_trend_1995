---
title: "Spatial predictors and temportal predictions of TOC in boreal lakes"
author: "Camille Crapart"
date: "19 05 2022"
output: 
  bookdown::word_document2:
   toc: false
   toc_float: false
   number_sections: false
   fig_caption: true
   extra_dependencies: "subfig"
always_allow_html: true
bibliography: C:\\Users\\raine\\Documents\\UiO\\Bibtex\\Finstad.bib
csl: C:\\Users\\raine\\Documents\\UiO\\styles-master\\styles-master\\chicago-author-date-fr.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F, error = F)
options(knitr.kable.NA="", kableExtra.auto_format = F)
```

```{r libraries-data, results=F}
library(captioner)
library(dplyr)
library(kableExtra)
library(grid)
library(gridExtra)
library(png)
memory.limit(size = 100000)

fennoscandia <- readRDS("fennoscandia.Rdata")
wr.sf.95 <- readRDS("wr.sf.95.rds")
```

```{r captioner}
fig_nums <- captioner() 
table_nums <- captioner(prefix = "Table")
```

# Methods

## Data preparation 

The dataset comprised the `r dim(fennoscandia)[1]` lakes sampled during the Northern Lake Survey in 1995 [@Henriksen1998]. Eight explanatory parameters, describing each of the 4 736 catchments, were compiled as predictor variables (i.e., NDVI, proportion of forest (Forest), arable land (Arable) and peat (Bog), mean runoff intensity (Runoff), precipitation intensity (Precip) and temperature (Temp), total nitrogen (TN-dep)). These descriptors were computed as mean values of each parameter over the catchment (`r fig_nums("insert-maps", display = "c")`). The complete procedure for extraction, compilation and preparation of historic data is available in Supplementary 1. Here a short summary is presented. All logarithmic transformations use the natural logarithm.

* The total organic carbon (TOC) concentration (`r fig_nums("insert-maps", display = "c")`a). The data were extracted from the Northern Lake Survey dataset from 1995, with the denomination mg C/L. As the TOC concentration values were skewed, the data were log-transformed (log TOC) to normalize the distribution.

* Normalized difference vegetation index (NDVI) (`r fig_nums("insert-maps", display = "c")`b) for the summer months (June, July and August) are used a proxy for the amount of vegetation (primarily forest) biomass. They were downloaded from the GIMMS database and averaged  for 1994, i.e., the year preceding sampling @TheNationalCenterforAtmosphericResearch2018. 

* Mean runoff (Runoff) values as L/m2/s (i.e., mm/s, converted in mm/y) (`r fig_nums("insert-maps", display = "c")`c) were derived from the CORDEX model for the period 1960 to 199031 @CORDEXvERC @Kreienkamp2012. As the runoff intensities were skewed the data were log-transformed (log Runoff) to normalize the distribution . 

* Mean annual precipitation (Precip) in mm/y (`r fig_nums("insert-maps", display = "c")`e) and temperature (Temp) in degrees of centigrade (ºC) (`r fig_nums("insert-maps", display = "c")`d) for the years 1970 to 2000 were downloaded from the WorldClim database @WorldClim. As the precipitation distribution was not normally distributed the data were log transformed (log Precip).

*	Proportions of Bogs, arable land (Arable) and forested area (Forest) (`r fig_nums("insert-maps", display = "c")`f, g, and h, respectively) within each catchment are computed from the Corine Land Cover (CLC) database @CopernicusCLC, and correspond to the data of 2000, as land use data prior to this were not available. Several CLC categories were merged to create the three categories used in this study (see Supplementary 1). Although distributions of the different land use are not normally distributed they are not log transformed due to many zeros in the data. Other possible transformations (square, square roots) did not contribute to normalize the distribution. 

*	Total nitrogen deposition (TN-dep) data in ugN/m2 and total sulphur deposition (TSdep) data in ugS/m2  (`r fig_nums("insert-maps", display = "c")`i and j, respectively) were extracted from EMEP models as the sum of dry and wet deposition @EMEP. Data from 2000 were used as this were the first available data.


Future changes in climate parameters are based on predicted changes in climate drivers derived from the Coupled Model Intercomparison Project (Phase 6) (CMIP6), run by the World Climate Research Program [@WRCP22] using two different socio-economic pathways: [@Riahi2017] SSP1-2.6 as the best scenario, assuming the global warming will be limited to less than 2°C, and SSP 3-7.0 as the worst-case scenario [@Hausfather2019; @CORDEX2021]. Several institutions run the CMIP6 models to forecast future climate. Based on @Raju2020, the results from the model developed by the CRNM (Centre National de Recherches Météorologiques) were selected to extract future runoff, temperature, and precipitation values.

## Spatial TOC models

@Larsen2011 used a multiple linear regression model (LM) to predict the effect of climate change on the TOC concentration in 1 000 Norwegian lakes. In this study, including almost 4 000 lakes in Sweden and Finland, a similar linear model is reproduced to investigate the role of the three predictors selected by Larsen et al. and other conceptually relevant predictors in explaining the spatial differences in TOC levels in Norway, Sweden, and Finland. 

The spatial autocorrelation of all the predictors were determined by computing the Moran's I (see details in Supplementary 4). All variables were spatially autocorrelated. In order to take this into account, a Spatial Error Linear Model was fitted with the same predictors as for the LM and the results compared. 

The LM and SELM models are fitted and estimates (i.e., slope “a” as in the simple model $y=ax+b$) evaluated both on scaled and unscaled variables, and estimates. The scaled estimates (computed with centered and normalized variables) are used to compare the impact of the predictor variables on the same scale, while the unscaled estimates are used to estimate the effect sizes. The equations used to calculate the effect size for each pair response/predictor variable are explained in Supplementary 4.

## Test of the Spatial Model on 1000-lakes-survey (2019) data

In 2019, a large survey covering 1000 Norwegian lakes was realized by the Norwegian Institute for Water Research [@NIVA2020]. The same lakes as in 1995 were sampled again and TOC concentration measured. Catchment polygons were computed with an elevation model. Land-cover data come from the Norwegian mapping service [@Kartverket]. Nitrogen and Sulfur deposition are EMEP data compiled by the Norwegian Institute for Air Research [@NILU2012]. Precipitation and Temperature data were extracted from the European Centre for Medium-Range Weather Forecasts (ECMWF, ERA5 dataset [@ECMWF2019]). NDVI data was also extracted from GIMMS database [@TheNationalCenterforAtmosphericResearch2018] for the purpose of this study. Details about the data from NIVA is available in Supplementary 3. 


## Forecast of TOC prediction in sea watersheds

Future changes in TOC concentrations are forecasted using the SELM based on main predictors. In order to cover the whole territory of Fennoscandia, and not only some of the lakes catchments as with the Northern lake Survey, we used the polygons representing the sea watersheds. Sea watersheds are the ensemble of the watercourse that drain to the sea within a coastal section [@NVE]. The sea watersheds were computed from an elevation model (ref Anders). After cleaning, the dataset is composed of 1392 polygons (see Supplementary 3).

Future changes in climate parameters are based on predicted changes in climate drivers derived from the Coupled Model Intercomparison Project (Phase 6) (CMIP6), run by the World Climate Research Program [@WRCP22] using two different socio-economic pathways: [@Riahi2017] SSP1-2.6 as the best scenario, assuming the global warming will be limited to less than 2°C, and SSP 3-7.0 as the worst-case scenario [@Hausfather2019; @CORDEX2021]. Several institutions run the CMIP6 models to forecast future climate. Based on @Raju2020, the results from the model developed by the CRNM (Centre National de Recherches Météorologiques) were selected to extract future runoff, temperature, and precipitation values.

Since there is no forecast for NDVI in CMIP6, summer NDVI values for 2050 and 2100 were instead predicted using a spatial error model based on forecast for temperature and precipitations in the period 2041-2060 and for the period 2081-2100. This model was fitted using summer NDVI, temperature and precipitations in 1995 (mean 1970-2000). Average temperature and precipitation for 1995 were extracted from the Worldclim database @WorldClim. Future temperature and precipitation values are extracted from the CRNM-CM6 model. Modeled NDVI and changes in NDVI in the future are shown in Supplementary 2.

# Results and discussion

## Selection of predictor variables

### Mapping of predictor and response variable

Nine explanatory parameters i.e., NDVI, Runoff, Precip, Temp, Bogs, Arable, Forest, TN-dep and TSdep, describing each of the  `r dim(fennoscandia)[1]` catchments as predictor variables, were computed as mean values of each parameter over the catchment (`r fig_nums("insert-maps", display = "c")`).

```{r insert-maps, fig.dim = c(18,24), fig.align = "center"}
listgrob <- list("map.TOC.png","map.ndvi.png","map.Runoff.png","map.Precip.png","map.temp.png","map.Bog.png","map.arable.png","map.forest.png","map.tndep.png", "map.tsdep.png") %>% lapply(readPNG) %>% lapply(rasterGrob)
grid.arrange(grobs = listgrob, ncol = 3)
```

`r fig_nums("insert-maps", "Maps of DOM (TOC, a) and its predictor variables : Biomass (NDVI, b), mean runoff intensity (Runoff, c), temperature (Temp, d), precipitation intensity (Precip, e), peat (Bog, f), proportion of forest (Forest, c), and arable land (Arable, d), total nitrogen deposition (TN-dep, i) and total sulfur deposition (TS.dep, j) in the studied catchments")`

### Pearson Correlation coefficient, autocorrelation and Variance Inflation Factor

```{r p-I-VIF}
m <- c("logTOC","NDVI","logRunoff","logPrecip","Temp","Bog","Arable","Forest","TNdep","TSdep")
cor.mat <- cor(dplyr::select(fennoscandia,m))

lm.all <- lm(data = fennoscandia, formula = as.formula(paste(m[1],"~",paste(m[-1],collapse = "+"))))
lm.vif <- car::vif(lm.all) %>% as.data.frame() %>% setNames("VIF")

moran.df <- readRDS("moran.df.Rdata")

moran.limit <- 1/(dim(fennoscandia)[1]-1)

moran.vif.df <- merge(moran.df,lm.vif, by.x = "parameter", by.y = 0)
moran.vif.df[,2:4] <- round(moran.vif.df[,2:4],2)
moran.vif.df <- moran.vif.df[,-3]
```

Too highly correlated variables in a model compromise the confidence of of the results of a linear model. Here we investigate the Pearson Correlation coefficients for each pair of variable (response and predictor) were computed (`r table_nums("corrplot", display = "c")`). In addition, the Moran's I of each variable was calculated (`r table_nums("moran-vif-table", display = "c")`). Considering the number of observations, the maximum Moran's I value for a non-autocorrelated variable would be `r format(moran.limit,scientific = T, digits = 2)`. All the variables in this study had a Moran's I superior to this limit, indicating a certain degree au autocorrelation. Finally, the Variance Inflation Factor (VIF) for each of the predictor variable was computed and presented in `r table_nums("moran-vif-table", display = "c")`. The VIF is also an indication of how a single predictor is globally correlated to the others: a predictor with a high VIF is correlated with many others, and can jeopardize the fit.

`r table_nums("corrplot", "Correlation plot for predictor variables")`

```{r corrplot, fig.dim=c(4,4)}
corrplot::corrplot(cor.mat, method = "number",type = "lower", number.cex = 0.7, tl.col = "black", tl.cex = 0.7, cl.cex = 0.7, order = "hclust")
```


```{r moran-vif-print}
moran.vif.df %>% arrange(desc(moran.I)) %>%
  dplyr::mutate(VIF = cell_spec(VIF,color = ifelse(VIF > 3,"red", "black"), bold = ifelse(VIF > 5, T, F)),
    moran.I = cell_spec(moran.I,bold = ifelse(moran.I > moran.limit, T, F),color = ifelse(moran.I > 0.8, "red","black"))) %>%
  knitr::kable(digits = 2, 
    caption = table_nums("moran-vif-table",paste("Moran’s I (i.e., spatial autocorrelation) and Variance Inflation Factor (VIF) (i.e., multicollinearity in the correlation) of predictor and predictor variable (Moran’s I limit = ", format(moran.limit,scientific = T, digits = 2),")",sep = "")),
    label = NA,
    escape = F,
    col.names = c("Predictor","Moran's I","VIF")) %>%    
  kable_styling(bootstrap_options = "bordered", position = "center")
        
```

Several of the predictor variables were correlated together. TNdep, TSdep and Temp were closely correlated. TNdep and TSdep are extremely highly correlated (r =  `r round(cor(fennoscandia$TNdep,fennoscandia$TSdep),2)`). The correlation coefficient between TNdep and Temp is `r round(cor(fennoscandia$Temp,fennoscandia$TNdep),2)` and the correlation coefficient between TSdep and Temp is `r round(cor(fennoscandia$Temp,fennoscandia$TSdep),2)`. TSdep also has the highest VIF (VIF = `r round(lm.vif["TSdep",],2)`), followed by TNdep (VIF = `r round(lm.vif["TNdep",],2)`). Temp, TNdep and TSdep have a very high Moran's I too (all around 0.9) showing a very strong spatial pattern. This can be explained because both N and S deposition are higher in the warmer southern regions of Fennoscandia. TSdep has been highlighted by several studies as the main predictor of TOC concentration [@Monteith2007]. Considering that the level of atmospheric deposition of sulfur came back to pre-industrial level and is unlikely to evolve significantly, we chose to keep TNdep as a predictor for atmospheric deposition in this study.  

Forest and NDVI were also closely correlated (r =  `r round(cor(fennoscandia$Forest,fennoscandia$NDVI),2)`), even if they do not match as closely as could be effected. Even if the resolution of the Corine Land Cover dataset is finer than the NDVI dataset, NDVI is slighly more closely correlated to logTOC (r =  `r round(cor(fennoscandia$logTOC,fennoscandia$NDVI),2)`) than Forest (r =  `r round(cor(fennoscandia$logTOC,fennoscandia$Forest),2)`). The NDVI takes into account all kind of vegetation, as well of the density of the vegetation. Moreover, its VIF was lowere than the VIF of Forest (`r round(lm.vif["NDVI",],2)` compared to `r round(lm.vif["Forest",],2)`), showing that it is less correlated to the other predictor variables. Therefore, this parameter will be kept as a biomass proxy in this study.

LogRunoff and LogPrecip were also highly positively correlated (r =  `r round(cor(fennoscandia$Forest,fennoscandia$NDVI),2)`). LogPrecip had a highest VIF than logRunoff (`r round(lm.vif["logPrecip",],2)` compared to `r round(lm.vif["logRunoff",],2)`), showing more general correlation to the other predictors, but a lower Moran's I (`r round(moran.df[which(moran.df$parameter == "logPrecip"),2],2)` compared to `r round(moran.df[which(moran.df$parameter == "logRunoff"),2],2)`). Conceptually, surface runoff is the predictor most correlated to TOC export from catchment to streams and lakes: a part of the precipitation volume evaporates or infiltrate into ground reservoirs, and do not reach the water bodies. Here, logRunoff is indeed more correlated to logTOC (r =  `r round(cor(fennoscandia$logTOC,fennoscandia$logRunoff),2)`) than logPrecip are correlated (r =`r round(cor(fennoscandia$logTOC,fennoscandia$logPrecip),2)`). LogRunoff was therefore preferred to be a predictor in the model. 

Bog and Arable proportion were not highly correlated to any other variable and both had low VIF and Moran's I. Therefore, both of them were kept in the model as predictors.

## Modelling of TOC concentration on the Northern Lake Survey dataset

A linear model (LM) and a Spatial Error Model (SELM) were fitted for the log TOC on the 5 predictors selected in the previous section. 
 The SELM takes into account the spatial autocorrelation of the predictor variables in the error term of the regression. To compare the two models, the Akaike Information Criterion (AIC) was calculated. The AIC for each model are presented in Supplementary 1.

Both models were fitted with and without scaled variables. This allows us to compare the  regression coefficients  and effect size  for each predictor variables is shown on `r fig_nums("compare-plots-1", display = "c")`). 

The effect sizes are expressed as % change in TOC concentration caused by a 1% increase in NDVI (0.01 on the NDVI index), runoff, bog and forest coverage and arable land (proportion increase of 0.01), a 25 ug/m2  increase of nitrogen deposition (1% of the range of TNdep) and a 11 ug/m2 increase in sulfur deposition (1% of the range of TSdep), respectively. The relative change of 1% is arbitrarily chosen to represent the impact of each predictor variable on a comparable basis and can be understood as follow: a catchment with a given set of characteristics has a TOC concentration A. If one of the predictor, x, increases by $\delta x$, the TOC concentration will become $A + \delta A$. In this study, we consider that the wide gradient of the predictor and the robustness of the SELM model allows us to compare two neighbouring catchments. If catchment B as a TOC concentration $TOC_{B}$, an increase of 1% of the value of $x_{B}$ will also result in an increase of TOC concentration of $x + \delta x$. 

Scaled estimates, fitted on response and predictors variables that are also centered and scaled, show the degree of contribution of each the predictor to the response variable value but not the extent of this impact on the real scale. 

```{r load-tables-9}
s.lm.coef.5 <- readRDS("s.lm.coef.5.rds")
s.sem.coef.5 <- readRDS("s.sem.coef.5.rds")
lm.effectsize.5 <- readRDS("lm.effectsize.5.rds")
sem.effectsize.5 <- readRDS("sem.effectsize.5.rds")
```

```{r compare-plot-9}
knitr::include_graphics("compare.lm.selm.5.png")
```

`r fig_nums(name = "compare-plots-5",caption = "Comparison of scaled estimate (left) and effect sizes for a 1% increase in the predictor variables (right) using LM and SELM models, based on the Fennoscandian dataset with the 5 selected predictors", display = "f")`

In both LM and SELM, the strongest predictor for logTOC is the NDVI. LM gives an higher impact to NDVI with an estimate of  `r round(s.lm.coef.5[which(s.lm.coef.5$Parameter == "NDVI"), which(names(s.lm.coef.5) == "Estimate")],2)` and an effectsize of `r round(lm.effectsize.5[which(lm.effectsize.5$Parameter == "NDVI"), which(names(lm.effectsize.5) == "Estimate")],2)`, while SELM gave a scaled estimate of `r round(s.sem.coef.5[which(s.sem.coef.5$Parameter == "NDVI"), which(names(s.sem.coef.5) == "Estimate")],2)` and an effectsize of `r round(sem.effectsize.5[which(sem.effectsize.5$Parameter == "NDVI"), which(names(sem.effectsize.5) == "Estimate")],2)`. LogRunoff had high scaled estimates, especially for the LM (`r round(s.lm.coef.5[which(s.lm.coef.5$Parameter == "logRunoff"), which(names(s.lm.coef.5) == "Estimate")],2)`), twice as much as the estimate for the SELM (`r round(s.sem.coef.5[which(s.sem.coef.5$Parameter == "NDVI"), which(names(s.sem.coef.5) == "Estimate")],2)`). The effect size of a 1% increase has a negative effect on the TOC concentration (`r round(lm.effectsize.5[which(lm.effectsize.5$Parameter == "logRunoff"), which(names(lm.effectsize.5) == "Estimate")],2)` for LM and `r round(sem.effectsize.5[which(sem.effectsize.5$Parameter == "logRunoff"), which(names(sem.effectsize.5) == "Estimate")],2)` for SELM). Bog, despite its low correlation with logTOC (`r round(cor(fennoscandia$logTOC,fennoscandia$Bog),2)`), has relatively high scaled estimates (`r round(s.lm.coef.5[which(s.lm.coef.5$Parameter == "Bog"), which(names(s.lm.coef.5) == "Estimate")],2)` for LM and `r round(s.sem.coef.5[which(s.sem.coef.5$Parameter == "Bog"), which(names(s.sem.coef.5) == "Estimate")],2)` for SELM) and effect sizes (`r round(lm.effectsize.5[which(lm.effectsize.5$Parameter == "Bog"), which(names(lm.effectsize.5) == "Estimate")],2)` for LM and `r round(sem.effectsize.5[which(sem.effectsize.5$Parameter == "Bog"), which(names(sem.effectsize.5) == "Estimate")],2)` for SELM). On the contrary, Arable had very low impact on TOC, with a slighly negative effectsize (`r round(lm.effectsize.5[which(lm.effectsize.5$Parameter == "Arable"), which(names(lm.effectsize.5) == "Estimate")],2)` for LM and `r round(sem.effectsize.5[which(sem.effectsize.5$Parameter == "Arable"), which(names(sem.effectsize.5) == "Estimate")],2)` for SELM).

TNdep also had relatively slow scaled estimates (`r round(s.lm.coef.5[which(s.lm.coef.5$Parameter == "TNdep"), which(names(s.lm.coef.5) == "Estimate")],2)` for LM and `r round(s.sem.coef.5[which(s.sem.coef.5$Parameter == "TNdep"), which(names(s.sem.coef.5) == "Estimate")],2)` for SELM) and effect sizes (`r round(lm.effectsize.5[which(lm.effectsize.5$Parameter == "TNdep"), which(names(lm.effectsize.5) == "Estimate")],2)` for LM and `r round(sem.effectsize.5[which(sem.effectsize.5$Parameter == "TNdep"), which(names(sem.effectsize.5) == "Estimate")],2)` for SELM), even if TNdep was somehow correlated with logTOC (`r round(cor(fennoscandia$logTOC,fennoscandia$TNdep),2)`). TSdep has been proven to have, locally, a negative impact on TOC concentration. TNdep has a positive impact on TOC concentration. This can be due to the spatial repartition of TNdep: it is higher in the Southern part of Scandinavia, where other factors explain the high observed TOC concentrations. It can also be due to the fertilizing effect of TNdep. The effect size is calculated for an increase of 25 ug/m2 of TNdep. The nitrogen deposition is linked to combustion of fossil fuel and agricultural uses in central Europe. Depending on the evolution of public policies in the next century, the average nitrogen deposition might decrease (SSP 1-2.6) or remain the same (SSP 3-7.0). Therefore, the impact of TNdep cannot be estimated without making assumptions on its future evolution. 

The SELM model had a lowest AIC (Aikaike Information Criteria) than the LM model (see Supplementary 1). It also resulted in estimates being less important than the LM. In particular, the fact that NDVI and Runoff has lower estimates and effect sizes with SELM than with LM, while TNdep had higher estimate and effect size with SELM compared to LM, shows that the model is more balanced and less likely to over or under-estimate the impact of each predictor. The Moran's I of the residuals is higher for the LM than for the SELM, showing a spatial pattern in the mis-fit. The SELM model performs therefore better in predicting the TOC concentration in boreal lakes and will be investigated further in the next section. 



## 1000-lakes-survey test

The data provided by NIVA was used to perform a real-life test of the space-for-time model. The model fitted on the 2019 data was used to predict the TOC concentration value in the 1000 lakes sampled by NIVA, and the result were compared with the actual observation. The computation is presented in Supplementary 3. 

```{r niva-test-results, fig.dim = c(8,10)}
listgrob <- list("NIVA_test/niva-test-result.png","NIVA_test/diff.niva.png") %>% lapply(readPNG) %>% lapply(rasterGrob)
grid.arrange(grobs = listgrob, ncol = 2)
```
`r fig_nums(name = "niva-test-result",caption = "Real-data test of the SELM model, a) predicted vs sampled log(TOC); b) map of the difference between observed and fitted log(TOC)", display = "f")`

The results show that the SELM model fitted with the 5 selected predictors gives a satisfactory result, with a the correlation between observed and fitted log(TOC) of 0.84. However, the model tends to under-estimate the average TOC concentration in sea watersheds with high initial TOC concentration, in particular in the south-eastern part of Norway, and over-estimate the TOC concentration in sea watersheds with a low initial TOC concentration. The space-for-time approach uses a set of explanatory values taken at a snap-shot moment in time, but in a large variety of regions, to model future changes. The relationships between the explanatory parameters and the response TOC at any single site is a result of biogeochemical processes that have developed in the soils since the last glacial epoch (i.e., 15 – 20 000 years). E.g., the long-term processes of generating the pool of soil organic matter. That these interdependencies are to respond in the course of decades is thus not realistic.

For example, sea watersheds in the middle of the Norwegian mountains are predicted to have a high TOC concentration compared to what they actually have: this is likely due to an increased NDVI in these regions, not yet followed by the soil formation that a similar  NDVI value in 1995 would imply. Similarly, the lakes in South East Norway were the most affected by S-deposition and the 1995 dataset was still dependent on this variable. In 2019, TNdep (proxy for TSdep) is not such a strong predictor anymore. In 2019, high TNdep does not necessarily mean high TSdep (hence low TOC concentration) anymore: therefore the lakes in the south east are underfitted. They now have more TOC than what they would have had with a higher TNdep/TSdep in the past.

The prediction range and the difference observed/predicted in this study provides nevertheless a good indication in most catchments. Having in mind the potential discrepancies, this model can be used to obtain an indication of future TOC concentration under various climate conditions. 

## Forescast with SSP1-2.6 and SSP3-7.0

Future average TOC concentration were computed for `r dim(wr.sf.95)[1]` sea watersheds in Norway, Sweden and Finland. The sea watersheds are drainage basins with an outlet in the sea, either the Baltic sea for watersheds in Sweden and Finland, or the North and Norwegian sea for watersheds in Norway. 

Sea watersheds gather several lakes and catchments, and there is no experimental data for their respective average TOC concentration of their various water bodies. Therefore, the first step was to compute the TOC concentration in 1995 using the Spatial Error Linear Model fitted in the above section. In a second step, the forecast of the predictor variables (NDVI with Temperature and Precipitation, Runoff, and future TNdep) were extracted from CMIP6 climate models. Finally, the average TOC concentration was computed for two distinct scenario: SSP1-2.6 (global warming limited to less than 2°C), and SSP 3-7.0 (global warming up to 4°C); and for two time periods: 2041-2060 and 2081-2100 (abbreviated as "2050" and "2100". Average temperature in septentrional regions are more strongly affected by global warming than regions at lower latitudes: in Finnmark, temperatures under the SSP3-7.0 could reach up to 7,5°C. The details of predictor extraction and model fitting are presented in Supplementary 2. 

The results of the TOC forecast in sea watershed in shown on `r `fig_nums("ssp-toc",display = "c")`. Here, we focus on the difference between log(TOC) fitted for the different climate scenarios, and the log(TOC) fitted for 1995. We assume that the over- or under-estimation of TOC concentration, highlighted by the test on 2019-data, is partially compensated by this double-fit. 


```{r ssp-toc, fig.dim= c(12,16)}
listgrob <- list("WR/SSP126.2050.diff.log.png", "WR/SSP126.2100.diff.log.png","WR/SSP370.2050.diff.log.png","WR/SSP370.2100.diff.log.png") %>% lapply(readPNG) %>% lapply(rasterGrob)
grid.arrange(grobs = listgrob, ncol = 2)
```

`r fig_nums("ssp-toc","Forecast of TOC concentration under SSP 1-2.6 and SSP 3.7-0 (mg/L)")`

## Coastal darkening

Coastal darkening issues have raised attention since ..., highlighting that increases of TOC concentration in surface freshwater consequently led to an increase of the export of TOC to the coastal water. REFERENCE

Modelling future TOC concentration in sea watersheds makes it possible to estimate as well the future export of TOC towards the Baltic sea and the Norwegian coast. Most sea watersheds in Sweden and Finland drain into to the Baltic Sea (see Supplementary 2), while Norwegian sea watershed drain in Skagerrak, in the North sea, in the Norwegian Sea and in the Barent sea in the North [@Saetre2007]. All contribute to the Norwegian Coastal Current water masses.  The estimated exported TOC was computed as 

$$ TOC_exp = [TOC] (mg.L^{-1}) \times Runoff (mm/y, or L.m^{-2}.y^{-1}) \times Watershed area (m^2)$$

Where the TOC concentration (past and future) was obtained by back-transforming the results of the model (log(TOC)) into TOC in mg/L. The result of the above equation, giving the amount of TOC exported in mg, is converted to Tg. 

```{r future-darkening, fig.dim = c(16,8)}
listgrob <- list("WR/TOC_export_abs.png","WR/TOC_export.png") %>% lapply(readPNG) %>% lapply(rasterGrob)
grid.arrange(grobs = listgrob, ncol = 2)
```

The Baltic Sea outflow contributes at 50% to the freshwater in the Norwegian Coastal Current , while freshwater runoff from Norway contributes to 40% (@Saetre2007). Under the SSP126 scenario, the export of TOC will increase both in the Baltic sea and on the Norwegian coast, resulting in a net increase in the Norwegian Coastal Current. Under the SSP370 scenario, the net TOC import in the Norwegian Coastal Current   will first increase slightly in the forecast for 2041-2060, but will then decrease for the period 2081-2100.


# References